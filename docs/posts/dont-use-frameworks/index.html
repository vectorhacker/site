<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Stop using frameworks for everything. Just stop. You don&amp;rsquo;t need a framework to write good code and deliver products. Don&amp;rsquo;t get me wrong, frameworks are useful, but they are all-consuming and hide the application. So if you shouldn&amp;rsquo;t depend on frameworks what should you do instead? Clean architecture. More specifically, there are some patterns you can follow to better architect your application and think about the structure of your application and remove the need for frameworks to express your application." />
<meta name="keywords" content="blog, victor, personal, wiki, bliki, opinions" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://victoramartinez.com/posts/dont-use-frameworks/" />


    <title>
        
            Don&#39;t Use Frameworks :: Victor&#39;s Blog  â€” Ramblings of a Software Professional
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.d235e788b40b442aba9cd6c69fdc330353b2dec27dcbc4235961469d2155f5a9.css">




<meta itemprop="name" content="Don&#39;t Use Frameworks">
<meta itemprop="description" content="Stop using frameworks for everything. Just stop. You don&rsquo;t need a framework to write good code and deliver products. Don&rsquo;t get me wrong, frameworks are useful, but they are all-consuming and hide the application. So if you shouldn&rsquo;t depend on frameworks what should you do instead? Clean architecture. More specifically, there are some patterns you can follow to better architect your application and think about the structure of your application and remove the need for frameworks to express your application."><meta itemprop="datePublished" content="2020-03-24T04:32:51-04:00" />
<meta itemprop="dateModified" content="2020-03-24T04:32:51-04:00" />
<meta itemprop="wordCount" content="2126"><meta itemprop="image" content="https://victoramartinez.com/"/>
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://victoramartinez.com/"/>

<meta name="twitter:title" content="Don&#39;t Use Frameworks"/>
<meta name="twitter:description" content="Stop using frameworks for everything. Just stop. You don&rsquo;t need a framework to write good code and deliver products. Don&rsquo;t get me wrong, frameworks are useful, but they are all-consuming and hide the application. So if you shouldn&rsquo;t depend on frameworks what should you do instead? Clean architecture. More specifically, there are some patterns you can follow to better architect your application and think about the structure of your application and remove the need for frameworks to express your application."/>
<meta name="twitter:site" content="@https://www.twitter.com/vectorhacker"/>





    <meta property="article:published_time" content="2020-03-24 04:32:51 -0400 AST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">echo &#34;Hey!&#34;</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://victoramartinez.com/about/">About</a></li><li><a href="https://victoramartinez.com/posts">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>10 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://victoramartinez.com/posts/dont-use-frameworks/">Don&rsquo;t Use Frameworks</a>
            </h1>

            

            <div class="post-content">
                <p>Stop using frameworks for everything. Just stop. You don&rsquo;t need a framework to write good code and deliver products. Don&rsquo;t get me wrong, frameworks are useful, but they are all-consuming and hide the application. So if you shouldn&rsquo;t depend on frameworks what should you do instead? Clean architecture. More specifically, there are some patterns you can follow to better architect your application and think about the structure of your application and remove the need for frameworks to express your application. The patterns I suggest you use are <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a>, <a href="https://www.infoq.com/minibooks/domain-driven-design-quickly/">Domain Driven Design</a>, and the <a href="https://www.youtube.com/watch?v=t86v3N4OshQ">SOLID</a> principles. Having a maintainable application is a matter of applying certain design principles and professionalism. In particular, applying <a href="https://blog.cleancoder.com/uncle-bob/2014/12/17/TheCyclesOfTDD.html">TDD</a> or BDD and Domain Driven Design principles. Think about your application before you write a single line of code, design it, and test before you implement it.</p>
<p>What should you do about frameworks then? You can still use them, but only as plugins to your application. The use of a framework should be done by implementing internal interfaces for your applications&rsquo; inner layers. Let me ask you this, how many times have you answered the question &ldquo;what is your architecture?&rdquo; with a phrase like &ldquo;We have a ruby on rails back-end persisted by postgres using an angular front-end?&rdquo; If you have, what you have just described is not an architecture, it is an application stack. And what is the application stack? The stack is a detail! No one cares what your application stack is, well no one who wants to get the work done cares what it is, and you shouldn&rsquo;t either. To be fair, I&rsquo;m not saying your technology stack isn&rsquo;t important at some level, I&rsquo;m saying that it&rsquo;s a detail. So what is an application&rsquo;s architecture then? It is the system of patterns that we use to carry out our application&rsquo;s functionality. Your architecture could be a simple CRUD system, or it might be a complex trading application that receives trade orders as incoming messages and delivers them by reserving credits and emitting order events depending on what state you&rsquo;re in. One thing is clear, your application&rsquo;s architecture is driven by the domain you&rsquo;re in and the complexity of the problem you are solving, a framework is not architecture.</p>
<p>So what does a frameworkless application look like? Here&rsquo;s an example in Go. Let us start by the business rules and implement entities. In this example we&rsquo;re using a Cargo shipping application. Notice that our entities are free of any database dependencies and external concerns.</p>
<h3 id="entities">Entities</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// TrackingID uniquely identifies a particular cargo.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TrackingID</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Cargo is the central class in the domain model.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Cargo</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">TrackingID</span>         <span style="color:#a6e22e">TrackingID</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Origin</span>             <span style="color:#a6e22e">UNLocode</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">RouteSpecification</span> <span style="color:#a6e22e">RouteSpecification</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Itinerary</span>          <span style="color:#a6e22e">Itinerary</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Delivery</span>           <span style="color:#a6e22e">Delivery</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// SpecifyNewRoute specifies a new route for this cargo.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>) <span style="color:#a6e22e">SpecifyNewRoute</span>(<span style="color:#a6e22e">rs</span> <span style="color:#a6e22e">RouteSpecification</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">RouteSpecification</span> = <span style="color:#a6e22e">rs</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Delivery</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Delivery</span>.<span style="color:#a6e22e">UpdateOnRouting</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">RouteSpecification</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Itinerary</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// AssignToRoute attaches a new itinerary to this cargo.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>) <span style="color:#a6e22e">AssignToRoute</span>(<span style="color:#a6e22e">itinerary</span> <span style="color:#a6e22e">Itinerary</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Itinerary</span> = <span style="color:#a6e22e">itinerary</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Delivery</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Delivery</span>.<span style="color:#a6e22e">UpdateOnRouting</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">RouteSpecification</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Itinerary</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// DeriveDeliveryProgress updates all aspects of the cargo aggregate status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// based on the current route specification, itinerary and handling of the cargo.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>) <span style="color:#a6e22e">DeriveDeliveryProgress</span>(<span style="color:#a6e22e">history</span> <span style="color:#a6e22e">HandlingHistory</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Delivery</span> = <span style="color:#a6e22e">DeriveDeliveryFrom</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">RouteSpecification</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Itinerary</span>, <span style="color:#a6e22e">history</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// NewCargo creates a new, unrouted cargo.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCargo</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">TrackingID</span>, <span style="color:#a6e22e">rs</span> <span style="color:#a6e22e">RouteSpecification</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">itinerary</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Itinerary</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">history</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">HandlingHistory</span>{make([]<span style="color:#a6e22e">HandlingEvent</span>, <span style="color:#ae81ff">0</span>)}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Cargo</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">TrackingID</span>:         <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Origin</span>:             <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">Origin</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">RouteSpecification</span>: <span style="color:#a6e22e">rs</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Delivery</span>:           <span style="color:#a6e22e">DeriveDeliveryFrom</span>(<span style="color:#a6e22e">rs</span>, <span style="color:#a6e22e">itinerary</span>, <span style="color:#a6e22e">history</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The cargo object is an entity that is concerned with the carrying out of business rules related to shipping cargo, such as route assignments and delivery progress. We abstract the saving and retrieving of the cargo using the repository pattern and creating an interface for the repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// CargoRepository provides access a cargo store.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">CargoRepository</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Store</span>(<span style="color:#a6e22e">cargo</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>) <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Find</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">TrackingID</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>, <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">FindAll</span>() []<span style="color:#f92672">*</span><span style="color:#a6e22e">Cargo</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This interface is not given a concrete implementation at this step, instead, it is used in our use case through dependency injection in which the specific implementation will be chosen later. This is where our persistence technology will plug into. Notice how our application needs to know nothing about how cargo is persisted to use it, it is a detail we&rsquo;ll sort out later.</p>
<h3 id="use-cases">Use cases</h3>
<p>Our use cases are implemented by exposing a common use case interface for that particular use case and a hidden implementation that gets chosen using the factory pattern. That is to say, our use cases are expressed as interfaces with methods (actions) we can take. Use cases import only the inner layers of our application, such as the entities, and get injected with the concrete implementation of other interfaces like repositories and other uses cases.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Service is the interface that provides booking methods.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Service</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// BookNewCargo registers a new cargo in the tracking system, not yet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// routed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">BookNewCargo</span>(<span style="color:#a6e22e">origin</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>, <span style="color:#a6e22e">destination</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>, <span style="color:#a6e22e">deadline</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>) (<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// LoadCargo returns a read model of a shipping.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">LoadCargo</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>) (<span style="color:#a6e22e">Cargo</span>, <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// RequestPossibleRoutesForCargo requests a list of itineraries describing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// possible routes for this shipping.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">RequestPossibleRoutesForCargo</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>) []<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Itinerary</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// AssignCargoToRoute assigns a cargo to the route specified by the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// itinerary.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">AssignCargoToRoute</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#a6e22e">itinerary</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Itinerary</span>) <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ChangeDestination changes the destination of a shipping.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ChangeDestination</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#a6e22e">destination</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>) <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Cargos returns a list of all cargos that have been booked.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Cargos</span>() []<span style="color:#a6e22e">Cargo</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Locations returns a list of registered locations.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Locations</span>() []<span style="color:#a6e22e">Location</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">service</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cargos</span>         <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">CargoRepository</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">locations</span>      <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">LocationRepository</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">handlingEvents</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">HandlingEventRepository</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">routingService</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">RoutingService</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// NewService creates a booking service with necessary dependencies.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewService</span>(<span style="color:#a6e22e">cargos</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">CargoRepository</span>, <span style="color:#a6e22e">locations</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">LocationRepository</span>, <span style="color:#a6e22e">events</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">HandlingEventRepository</span>, <span style="color:#a6e22e">rs</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">RoutingService</span>) <span style="color:#a6e22e">Service</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">service</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">cargos</span>:         <span style="color:#a6e22e">cargos</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">locations</span>:      <span style="color:#a6e22e">locations</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">handlingEvents</span>: <span style="color:#a6e22e">events</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">routingService</span>: <span style="color:#a6e22e">rs</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">service</span>) <span style="color:#a6e22e">AssignCargoToRoute</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#a6e22e">itinerary</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Itinerary</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> len(<span style="color:#a6e22e">itinerary</span>.<span style="color:#a6e22e">Legs</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ErrInvalidArgument</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">cargos</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">AssignToRoute</span>(<span style="color:#a6e22e">itinerary</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">cargos</span>.<span style="color:#a6e22e">Store</span>(<span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">service</span>) <span style="color:#a6e22e">BookNewCargo</span>(<span style="color:#a6e22e">origin</span>, <span style="color:#a6e22e">destination</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>, <span style="color:#a6e22e">deadline</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>) (<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">origin</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">destination</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">deadline</span>.<span style="color:#a6e22e">IsZero</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">ErrInvalidArgument</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">NextTrackingID</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">RouteSpecification</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Origin</span>:          <span style="color:#a6e22e">origin</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Destination</span>:     <span style="color:#a6e22e">destination</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ArrivalDeadline</span>: <span style="color:#a6e22e">deadline</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">NewCargo</span>(<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">rs</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">cargos</span>.<span style="color:#a6e22e">Store</span>(<span style="color:#a6e22e">c</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">TrackingID</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">service</span>) <span style="color:#a6e22e">LoadCargo</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>) (<span style="color:#a6e22e">Cargo</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Cargo</span>{}, <span style="color:#a6e22e">ErrInvalidArgument</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">cargos</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Cargo</span>{}, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">assemble</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">handlingEvents</span>), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Location is a read model for booking views.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Location</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">UNLocode</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;locode&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>     <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Cargo is a read model for booking views.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Cargo</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ArrivalDeadline</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>      <span style="color:#e6db74">`json:&#34;arrival_deadline&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Destination</span>     <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;destination&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Legs</span>            []<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Leg</span> <span style="color:#e6db74">`json:&#34;legs,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Misrouted</span>       <span style="color:#66d9ef">bool</span>           <span style="color:#e6db74">`json:&#34;misrouted&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Origin</span>          <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;origin&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Routed</span>          <span style="color:#66d9ef">bool</span>           <span style="color:#e6db74">`json:&#34;routed&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">TrackingID</span>      <span style="color:#66d9ef">string</span>         <span style="color:#e6db74">`json:&#34;tracking_id&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example, we have a booking use case that handles the booking of new cargo. Notice how in the constructor we are expressing the repository dependencies as arguments and do no instantiate our implementations. Instead, concrete implementations of these interfaces are passed on to us, injected, in the main package. We also don&rsquo;t pass entities in and out of this layer to the outside, instead, we receive and output DTOs that are specific to this use case. These DTOS are just simple structs with no logic which we transform into and from our internal entities and value objects. We do not cheat and pass out our entities because that would couple them to the needs of the outside world, and we want to shield our innermost layers from change.</p>
<p>Now, where do we put in the framework if we use one? We put them on the outside and include our use cases as dependencies. For example, in our booking cargo use case, we will have HTTP handlers for each method in the service interface.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">bookingHandler</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">booking</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">logger</span> <span style="color:#a6e22e">kitlog</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bookingHandler</span>) <span style="color:#a6e22e">router</span>() <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">NewRouter</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Route</span>(<span style="color:#e6db74">&#34;/cargos&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Post</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">bookCargo</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">listCargos</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Route</span>(<span style="color:#e6db74">&#34;/{trackingID}&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">loadCargo</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;/request_routes&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">requestRoutes</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Post</span>(<span style="color:#e6db74">&#34;/assign_to_route&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">assignToRoute</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Post</span>(<span style="color:#e6db74">&#34;/change_destination&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">changeDestination</span>)
</span></span><span style="display:flex;"><span>		})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;/locations&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">listLocations</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Method</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;/docs&#34;</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StripPrefix</span>(<span style="color:#e6db74">&#34;/booking/v1/docs&#34;</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">FileServer</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Dir</span>(<span style="color:#e6db74">&#34;booking/docs&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">r</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bookingHandler</span>) <span style="color:#a6e22e">bookCargo</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">request</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Origin</span>          <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Destination</span>     <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">UNLocode</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ArrivalDeadline</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Body</span>).<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">request</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Log</span>(<span style="color:#e6db74">&#34;error&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">encodeError</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">BookNewCargo</span>(<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Origin</span>, <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Destination</span>, <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">ArrivalDeadline</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">encodeError</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">response</span> = <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ID</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span> <span style="color:#e6db74">`json:&#34;tracking_id&#34;`</span>
</span></span><span style="display:flex;"><span>	}{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ID</span>: <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;application/json; charset=utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewEncoder</span>(<span style="color:#a6e22e">w</span>).<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">response</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Log</span>(<span style="color:#e6db74">&#34;error&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">encodeError</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example, we are using the chi package to implement routing and include our booking service as a dependency. This layer has no application logic and only calls the appropriate methods on our use case, converting the raw data into and from dtos for our use case. When we instantiate our server implementation we pass in the use case implementations as arguments to the constructor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Server holds the dependencies for a HTTP server.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Server</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Booking</span>  <span style="color:#a6e22e">booking</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Tracking</span> <span style="color:#a6e22e">tracking</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Handling</span> <span style="color:#a6e22e">handling</span>.<span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Logger</span> <span style="color:#a6e22e">kitlog</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// New returns a new HTTP server.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">bs</span> <span style="color:#a6e22e">booking</span>.<span style="color:#a6e22e">Service</span>, <span style="color:#a6e22e">ts</span> <span style="color:#a6e22e">tracking</span>.<span style="color:#a6e22e">Service</span>, <span style="color:#a6e22e">hs</span> <span style="color:#a6e22e">handling</span>.<span style="color:#a6e22e">Service</span>, <span style="color:#a6e22e">logger</span> <span style="color:#a6e22e">kitlog</span>.<span style="color:#a6e22e">Logger</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Server</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Booking</span>:  <span style="color:#a6e22e">bs</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Tracking</span>: <span style="color:#a6e22e">ts</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Handling</span>: <span style="color:#a6e22e">hs</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Logger</span>:   <span style="color:#a6e22e">logger</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">NewRouter</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">accessControl</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Route</span>(<span style="color:#e6db74">&#34;/booking&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bookingHandler</span>{<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Booking</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Logger</span>}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Mount</span>(<span style="color:#e6db74">&#34;/v1&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">router</span>())
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Route</span>(<span style="color:#e6db74">&#34;/tracking&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">trackingHandler</span>{<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Tracking</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Logger</span>}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Mount</span>(<span style="color:#e6db74">&#34;/v1&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">router</span>())
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Route</span>(<span style="color:#e6db74">&#34;/handling&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">chi</span>.<span style="color:#a6e22e">Router</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">handlingHandler</span>{<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Handling</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Logger</span>}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Mount</span>(<span style="color:#e6db74">&#34;/v1&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">router</span>())
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Method</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;/metrics&#34;</span>, <span style="color:#a6e22e">promhttp</span>.<span style="color:#a6e22e">Handler</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">router</span> = <span style="color:#a6e22e">r</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Notice, no logic relating to our use case is here, only logic to satisfy our framework an be a bridge between our use case and the framework. In this way, the core of our application knows nothing about what frameworks we use. It doesn&rsquo;t care at all. The framework could be changed two weeks from now and you wouldn&rsquo;t have to change a thing about the use case because of it. The only time use cases or entities might change is when business requirements change, never for technical reasons.</p>
<p>What about the repositories? Those are an outside-in thing that gets implemented elsewhere. When we choose a persistence technology we simply implement that interface and it gets passed into our use cases upon application startup. Here&rsquo;s a trivial, but important illustration, of an in-memory repository for our Cargo example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Package inmem provides in-memory implementations of all the domain repositories.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">package</span> <span style="color:#a6e22e">inmem</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">shipping</span> <span style="color:#e6db74">&#34;github.com/marcusolsson/goddd&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">cargoRepository</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mtx</span>    <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cargos</span> <span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cargoRepository</span>) <span style="color:#a6e22e">Store</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">cargos</span>[<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">TrackingID</span>] = <span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cargoRepository</span>) <span style="color:#a6e22e">Find</span>(<span style="color:#a6e22e">id</span> <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">cargos</span>[<span style="color:#a6e22e">id</span>]; <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">val</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">ErrUnknownCargo</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cargoRepository</span>) <span style="color:#a6e22e">FindAll</span>() []<span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">mtx</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span>, <span style="color:#ae81ff">0</span>, len(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">cargos</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">val</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">cargos</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span> = append(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">val</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// NewCargoRepository returns a new instance of a in-memory cargo repository.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCargoRepository</span>() <span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">CargoRepository</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cargoRepository</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">cargos</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">TrackingID</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">shipping</span>.<span style="color:#a6e22e">Cargo</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You can imagine that in a production environment you would implement this using SQL or some NoSQL database and build the entities up from serialized values. The repository implementation is responsible for rebuilding the objects from persistence, the entities don&rsquo;t care as long as they&rsquo;re built correctly.</p>
<h2 id="conclusion">Conclusion</h2>
<p>So what should you take away from all this? That you don&rsquo;t need a framework. That simply applying these principles will get you far and frameworks are just plugins into your application. I recommend that you study these principles and practices more in-depth and stop thinking in terms of frameworks but in terms of your domain. What is it that you&rsquo;re trying to accomplish and build that, don&rsquo;t focus on the tools.</p>
<p>To see the entire code, go to the <a href="https://github.com/marcusolsson/goddd/">GoDDD repository</a> where a complete example of DDD in Go lives.</p>
<p>Also, check out the talks given by Uncle Bob on clean architecture. He&rsquo;s the OG when it comes to clean code and maintainability these days. Fair warning, he does tend to ramble a lot during the beginning of those talks with interesting anecdotes, but they&rsquo;re always fun to watch. He&rsquo;s also written several books you should check out on clean code and architecture.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=2dKZ-dWaCiU&amp;t=1290s">ITkonekt 2019 | Robert C. Martin (Uncle Bob), Clean Architecture and Design</a></li>
<li><a href="https://www.youtube.com/watch?v=NeXQEJNWO5w">Uncle Bob Martin - The Clean Coder</a></li>
<li><a href="https://www.youtube.com/watch?v=o_TH-Y78tt4">The Principles of Clean Architecture by Uncle Bob Martin</a></li>
<li><a href="https://www.youtube.com/watch?v=Nsjsiz2A9mg">Robert C Martin - Clean Architecture and Design</a></li>
</ul>
<p>Finally, check out the topics of Domain-Driven Design and SOLID. They will change the way you architect your applications, I guarantee it.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>2126 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-03-24 04:32 -0400</p>
        </div>

        
            <div id="comments" class="thin">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "vams" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            
            <span>Victor MartÃ­nez</span>
            <span> <a href="https://victoramartinez.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.fbf016a5f89be88f4916a0898302f777692ee6600991c3b6108fc423ed982dc83b470742cc92dd796861136f5ca96988b35e049b5f4cb4b1343686784a58c8ce.js" integrity="sha512-&#43;/AWpfib6I9JFqCJgwL3d2ku5mAJkcO2EI/EI&#43;2YLcg7RwdCzJLdeWhhE29cqWmIs14Em19MtLE0NoZ4SljIzg=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-110221350-2', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
